name: OpenFAST Windows Intel build

on:
  push:
  pull_request:
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-2022

    steps:
    - name: Checkout
      uses: actions/checkout@v4
      with:
        submodules: recursive

    # Install Intel oneAPI (CORRECT ACTION NAME)
    - name: Install Intel oneAPI
      uses: oneapi-src/setup-oneapi@v1
      with:
        components: >
          compiler-fortran
          compiler-dpcpp-cpp

    # MSVC environment
    - name: Setup MSVC
      uses: ilammy/msvc-dev-cmd@v1
      with:
        arch: x64

    # Sanity check
    - name: Check compiler
      shell: pwsh
      run: ifx --version

    # Configure
    - name: Configure
      shell: pwsh
      run: |
        mkdir build
        cd build
        cmake .. `
          -G "NMake Makefiles" `
          -DCMAKE_BUILD_TYPE=Release `
          -DCMAKE_Fortran_COMPILER=ifx

    # Build
    - name: Build
      shell: pwsh
      run: |
        cd build
        cmake --build . --parallel

    # Upload exe
    - name: Upload
      uses: actions/upload-artifact@v4
      with:
        name: openfast-windows
        path: build/**/*.exe
